<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DM Neuro Manager v32.0 (Integrated Billing)</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                    colors: {
                        primary: { 50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 900: '#0c4a6e' },
                        surface: '#ffffff',
                        background: '#f8fafc',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { background-color: #f8fafc; color: #1e293b; -webkit-font-smoothing: antialiased; }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- CONSTANTS ---
        const CLINIC_DETAILS = {
            name: 'DM Neuro',
            doctor: 'Dr. Kiran Madhav.T',
            contact: 'Kompally, Hyderabad'
        };

        const getToday = () => {
            const d = new Date();
            return new Date(d.getTime() - (d.getTimezoneOffset() * 60000)).toISOString().split('T')[0];
        };

        const formatCurrency = (amount) => {
            const val = parseFloat(amount);
            if (isNaN(val)) return '₹0';
            return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(val);
        };

        const generateId = () => Date.now().toString(36) + Math.random().toString(36).substr(2, 5);

        // --- COMPONENTS ---
        const Button = ({ children, onClick, variant = "primary", className = "", icon: Icon }) => {
            const variants = {
                primary: "bg-blue-600 text-white shadow-lg shadow-blue-500/30",
                secondary: "bg-white text-slate-600 border border-slate-200",
                danger: "bg-red-50 text-red-600 border border-red-100",
                success: "bg-emerald-600 text-white shadow-lg shadow-emerald-600/30"
            };
            return (
                <button onClick={onClick} className={`px-4 py-3 rounded-xl font-semibold active:scale-95 transition-transform flex items-center justify-center gap-2 text-sm ${variants[variant]} ${className}`}>
                    {Icon && <Icon size={18} />}
                    {children}
                </button>
            );
        };

        // --- FINANCE VIEW (UPDATED WITH INCOME TRACKER) ---
        const FinanceView = ({ visits, expenses, onAddExpense, onDeleteExpense, onQuickAddIncome }) => {
            const [tab, setTab] = useState('tracker'); // Default to the Simple Tracker
            const [quickForm, setQuickForm] = useState({ name: '', amount: '', mode: 'Cash' });
            const [expenseForm, setExpenseForm] = useState({ desc: '', amount: '' });

            // Stats for Today
            const todayStats = useMemo(() => {
                const today = getToday();
                const v = visits.filter(v => v.date === today);
                const income = v.reduce((sum, item) => sum + (parseFloat(item.fee)||0), 0);
                const count = v.length;
                return { income, count, list: v };
            }, [visits]);

            const handleQuickAdd = () => {
                if(!quickForm.name || !quickForm.amount) return;
                onQuickAddIncome({
                    name: quickForm.name,
                    fee: quickForm.amount,
                    paymentMode: quickForm.mode,
                    date: getToday(),
                    treatment: 'Quick Bill', // Default tag
                    referralType: 'Walk-in'
                });
                setQuickForm({ name: '', amount: '', mode: 'Cash' });
                alert("Added to Daily Income!");
            };

            const handleAddExpense = () => {
                if(!expenseForm.desc || !expenseForm.amount) return;
                onAddExpense({
                    description: expenseForm.desc,
                    amount: expenseForm.amount,
                    date: getToday()
                });
                setExpenseForm({ desc: '', amount: '' });
            };

            return (
                <div className="h-full flex flex-col slide-up pb-24 bg-white">
                    {/* Header */}
                    <div className="bg-slate-50 border-b border-slate-200 p-4 sticky top-0 z-10">
                         <h2 className="text-xl font-bold text-slate-800 mb-3">Finance & Billing</h2>
                         <div className="flex bg-white rounded-lg p-1 border border-slate-200 shadow-sm">
                             <button onClick={() => setTab('tracker')} className={`flex-1 py-2 text-xs font-bold rounded-md transition-colors ${tab === 'tracker' ? 'bg-slate-800 text-white' : 'text-slate-500'}`}>Daily Tracker</button>
                             <button onClick={() => setTab('expenses')} className={`flex-1 py-2 text-xs font-bold rounded-md transition-colors ${tab === 'expenses' ? 'bg-slate-800 text-white' : 'text-slate-500'}`}>Expenses</button>
                         </div>
                    </div>

                    {/* TAB 1: DAILY TRACKER (The Simple Tool You Liked) */}
                    {tab === 'tracker' && (
                        <div className="p-4 space-y-6">
                            {/* Big Total */}
                            <div className="bg-blue-900 rounded-2xl p-6 text-center text-white shadow-xl shadow-blue-900/20">
                                <p className="text-blue-200 text-xs uppercase font-bold tracking-wider mb-1">Today's Collection</p>
                                <h1 className="text-4xl font-bold">{formatCurrency(todayStats.income)}</h1>
                                <p className="text-xs text-blue-300 mt-2">{todayStats.count} Payments Received</p>
                            </div>

                            {/* Quick Add Form */}
                            <div className="bg-white rounded-xl border border-slate-200 p-4 shadow-sm">
                                <h3 className="text-sm font-bold text-slate-700 mb-3 flex items-center gap-2"><i data-lucide="zap" className="w-4 h-4 text-amber-500"></i> Quick Add Payment</h3>
                                <div className="flex gap-2 mb-2">
                                    <input type="text" placeholder="Patient Name" value={quickForm.name} onChange={e => setQuickForm({...quickForm, name: e.target.value})} className="flex-[2] bg-slate-50 border border-slate-200 rounded-lg p-2 text-sm outline-none" />
                                    <input type="number" placeholder="₹" value={quickForm.amount} onChange={e => setQuickForm({...quickForm, amount: e.target.value})} className="flex-1 bg-slate-50 border border-slate-200 rounded-lg p-2 text-sm font-bold outline-none" />
                                </div>
                                <div className="flex gap-2">
                                    <select value={quickForm.mode} onChange={e => setQuickForm({...quickForm, mode: e.target.value})} className="bg-slate-50 border border-slate-200 rounded-lg p-2 text-xs outline-none font-bold text-slate-600">
                                        <option>Cash</option><option>UPI</option><option>Card</option>
                                    </select>
                                    <button onClick={handleQuickAdd} className="flex-1 bg-blue-600 text-white rounded-lg py-2 text-sm font-bold shadow-md active:scale-95 transition-transform">Add Income</button>
                                </div>
                            </div>

                            {/* Today's List */}
                            <div>
                                <h3 className="text-xs font-bold text-slate-400 uppercase mb-3">Today's Transactions</h3>
                                <div className="space-y-2">
                                    {todayStats.list.length === 0 && <p className="text-center text-slate-400 text-xs py-4">No payments yet today.</p>}
                                    {todayStats.list.map(v => (
                                        <div key={v.id} className="flex justify-between items-center bg-white p-3 rounded-xl border border-slate-100 shadow-sm">
                                            <div>
                                                <p className="font-bold text-slate-700 text-sm">{v.name}</p>
                                                <p className="text-[10px] text-slate-400">{v.paymentMode} • {v.treatment}</p>
                                            </div>
                                            <span className="font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded text-xs">+{formatCurrency(v.fee)}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* TAB 2: EXPENSES */}
                    {tab === 'expenses' && (
                        <div className="p-4 space-y-4">
                            <div className="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                <h3 className="text-sm font-bold text-slate-700 mb-3">Log Expense</h3>
                                <div className="space-y-2">
                                    <input type="text" placeholder="Description (e.g., Tea, Cleaners)" value={expenseForm.desc} onChange={e => setExpenseForm({...expenseForm, desc: e.target.value})} className="w-full bg-white border border-slate-200 rounded-lg p-2 text-sm" />
                                    <div className="flex gap-2">
                                        <input type="number" placeholder="Amount" value={expenseForm.amount} onChange={e => setExpenseForm({...expenseForm, amount: e.target.value})} className="flex-1 bg-white border border-slate-200 rounded-lg p-2 text-sm" />
                                        <button onClick={handleAddExpense} className="bg-slate-800 text-white px-4 rounded-lg text-xs font-bold">Save</button>
                                    </div>
                                </div>
                            </div>
                            <div className="space-y-2">
                                {expenses.filter(e => e.date === getToday()).map(e => (
                                    <div key={e.id} className="flex justify-between items-center bg-white p-3 rounded-xl border border-slate-100">
                                        <span className="text-sm font-medium text-slate-700">{e.description}</span>
                                        <div className="flex items-center gap-3">
                                            <span className="font-bold text-red-500 text-xs">-{formatCurrency(e.amount)}</span>
                                            <button onClick={() => onDeleteExpense(e.id)} className="text-slate-300 hover:text-red-500"><i data-lucide="trash-2" className="w-4 h-4"></i></button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- DASHBOARD (SIMPLIFIED) ---
        const Dashboard = ({ visits, setView, onNewVisit }) => {
            const todayIncome = visits.filter(v => v.date === getToday()).reduce((acc, v) => acc + (parseFloat(v.fee) || 0), 0);
            return (
                <div className="p-5 space-y-6 slide-up">
                    <div className="flex justify-between items-center">
                        <div>
                            <h1 className="text-2xl font-bold text-slate-800">Welcome, Doc</h1>
                            <p className="text-slate-400 text-xs">{CLINIC_DETAILS.name}</p>
                        </div>
                        <div className="bg-white p-2 rounded-full border border-slate-100 shadow-sm">
                            <i data-lucide="activity" className="w-6 h-6 text-blue-500"></i>
                        </div>
                    </div>

                    <div className="bg-gradient-to-r from-blue-600 to-blue-500 rounded-2xl p-6 text-white shadow-lg shadow-blue-500/30">
                        <p className="text-blue-100 text-xs font-medium mb-1">Today's Income</p>
                        <h2 className="text-4xl font-bold">{formatCurrency(todayIncome)}</h2>
                        <div className="mt-4 flex gap-2">
                            <button onClick={() => setView('finances')} className="bg-white/20 hover:bg-white/30 px-3 py-1.5 rounded-lg text-xs font-bold backdrop-blur-sm transition-colors">View Details</button>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-3">
                        <div onClick={() => setView('visits')} className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm active:scale-95 transition-transform flex flex-col items-center gap-2 cursor-pointer">
                            <div className="bg-purple-100 p-3 rounded-full text-purple-600"><i data-lucide="users" className="w-6 h-6"></i></div>
                            <span className="text-sm font-bold text-slate-700">Patient List</span>
                        </div>
                        <div onClick={onNewVisit} className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm active:scale-95 transition-transform flex flex-col items-center gap-2 cursor-pointer">
                            <div className="bg-emerald-100 p-3 rounded-full text-emerald-600"><i data-lucide="plus" className="w-6 h-6"></i></div>
                            <span className="text-sm font-bold text-slate-700">New Patient</span>
                        </div>
                    </div>
                </div>
            );
        };

        // --- VISITS LIST ---
        const VisitsList = ({ visits, onDelete }) => {
            const [search, setSearch] = useState('');
            const filtered = visits.filter(v => v.name.toLowerCase().includes(search.toLowerCase()));

            return (
                <div className="h-full flex flex-col p-4 pb-24 slide-up">
                    <div className="sticky top-0 bg-slate-50 pb-4 z-10">
                        <input type="text" placeholder="Search patients..." value={search} onChange={e => setSearch(e.target.value)} className="w-full p-3 bg-white border border-slate-200 rounded-xl text-sm outline-none shadow-sm" />
                    </div>
                    <div className="space-y-3">
                        {filtered.map(v => (
                            <div key={v.id} className="bg-white p-4 rounded-xl border border-slate-100 shadow-sm flex justify-between items-center">
                                <div>
                                    <h3 className="font-bold text-slate-800">{v.name}</h3>
                                    <p className="text-xs text-slate-400">{v.date} • {v.treatment}</p>
                                </div>
                                <div className="text-right">
                                    <p className="font-bold text-slate-800">{formatCurrency(v.fee)}</p>
                                    <button onClick={() => onDelete(v.id)} className="text-[10px] text-red-400 mt-1">Delete</button>
                                </div>
                            </div>
                        ))}
                        {filtered.length === 0 && <p className="text-center text-slate-400 text-sm mt-10">No records found.</p>}
                    </div>
                </div>
            );
        };

        // --- ENTRY FORM ---
        const EntryForm = ({ onSave, onCancel }) => {
            const [form, setForm] = useState({ date: getToday(), name: '', phone: '', treatment: 'LBA', fee: '', paymentMode: 'Cash' });
            
            const save = () => {
                if(form.name && form.fee) onSave(form);
            };

            return (
                <div className="p-5 pb-24 slide-up bg-white min-h-screen">
                    <div className="flex items-center gap-3 mb-6">
                        <button onClick={onCancel} className="bg-slate-100 p-2 rounded-full"><i data-lucide="arrow-left" className="w-5 h-5 text-slate-500"></i></button>
                        <h2 className="text-xl font-bold text-slate-800">New Patient Record</h2>
                    </div>
                    <div className="space-y-4">
                        <input type="date" value={form.date} onChange={e => setForm({...form, date: e.target.value})} className="w-full p-3 bg-slate-50 rounded-xl outline-none border border-slate-200" />
                        <input type="text" placeholder="Full Name" value={form.name} onChange={e => setForm({...form, name: e.target.value})} className="w-full p-3 bg-slate-50 rounded-xl outline-none border border-slate-200" />
                        <input type="tel" placeholder="Phone Number" value={form.phone} onChange={e => setForm({...form, phone: e.target.value})} className="w-full p-3 bg-slate-50 rounded-xl outline-none border border-slate-200" />
                        <div className="grid grid-cols-2 gap-3">
                            <input type="number" placeholder="Fee (₹)" value={form.fee} onChange={e => setForm({...form, fee: e.target.value})} className="w-full p-3 bg-slate-50 rounded-xl outline-none border border-slate-200 font-bold" />
                            <select value={form.paymentMode} onChange={e => setForm({...form, paymentMode: e.target.value})} className="w-full p-3 bg-slate-50 rounded-xl outline-none border border-slate-200">
                                <option>Cash</option><option>UPI</option><option>Card</option><option>FOC</option>
                            </select>
                        </div>
                        <input type="text" placeholder="Treatment / Diagnosis" value={form.treatment} onChange={e => setForm({...form, treatment: e.target.value})} className="w-full p-3 bg-slate-50 rounded-xl outline-none border border-slate-200" />
                        
                        <Button onClick={save} className="w-full py-4 mt-4 shadow-xl">Save Record</Button>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [view, setView] = useState('dashboard');
            
            // DATA STORAGE (Local Storage)
            const [visits, setVisits] = useState(() => { 
                try { return JSON.parse(localStorage.getItem('dm_visits')) || []; } catch { return []; } 
            });
            const [expenses, setExpenses] = useState(() => { 
                try { return JSON.parse(localStorage.getItem('dm_expenses')) || []; } catch { return []; } 
            });

            useEffect(() => { 
                localStorage.setItem('dm_visits', JSON.stringify(visits)); 
                localStorage.setItem('dm_expenses', JSON.stringify(expenses));
                lucide.createIcons();
            }, [visits, expenses, view]);

            const handleSaveVisit = (data) => {
                const newVisit = { ...data, id: generateId() };
                setVisits([newVisit, ...visits]);
                setView('dashboard');
            };

            const handleQuickAddIncome = (data) => {
                const newVisit = { ...data, id: generateId() };
                setVisits([newVisit, ...visits]);
                // Stay on finance view
            };

            const handleDeleteVisit = (id) => {
                if(confirm("Delete this record?")) setVisits(visits.filter(v => v.id !== id));
            };

            const handleAddExpense = (data) => setExpenses([{...data, id: generateId()}, ...expenses]);
            const handleDeleteExpense = (id) => setExpenses(expenses.filter(e => e.id !== id));

            return (
                <div className="max-w-md mx-auto bg-slate-50 h-screen overflow-hidden flex flex-col shadow-2xl">
                    <div className="flex-1 overflow-y-auto">
                        {view === 'dashboard' && <Dashboard visits={visits} setView={setView} onNewVisit={() => setView('entry')} />}
                        {view === 'visits' && <VisitsList visits={visits} onDelete={handleDeleteVisit} />}
                        {view === 'finances' && <FinanceView visits={visits} expenses={expenses} onAddExpense={handleAddExpense} onDeleteExpense={handleDeleteExpense} onQuickAddIncome={handleQuickAddIncome} />}
                        {view === 'entry' && <EntryForm onSave={handleSaveVisit} onCancel={() => setView('dashboard')} />}
                    </div>
                    
                    {/* Bottom Navigation */}
                    {view !== 'entry' && (
                        <div className="bg-white border-t border-slate-200 p-2 flex justify-around items-center shrink-0">
                            <button onClick={() => setView('dashboard')} className={`p-2 flex flex-col items-center ${view === 'dashboard' ? 'text-blue-600' : 'text-slate-400'}`}>
                                <i data-lucide="layout-dashboard" className="w-6 h-6"></i>
                                <span className="text-[10px] font-bold mt-1">Home</span>
                            </button>
                            <button onClick={() => setView('visits')} className={`p-2 flex flex-col items-center ${view === 'visits' ? 'text-blue-600' : 'text-slate-400'}`}>
                                <i data-lucide="users" className="w-6 h-6"></i>
                                <span className="text-[10px] font-bold mt-1">Patients</span>
                            </button>
                            <button onClick={() => setView('finances')} className={`p-2 flex flex-col items-center ${view === 'finances' ? 'text-blue-600' : 'text-slate-400'}`}>
                                <i data-lucide="pie-chart" className="w-6 h-6"></i>
                                <span className="text-[10px] font-bold mt-1">Finances</span>
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

